name: vocabulary-hub

on:
  push:
    branches: ["main"]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Setup Bun
        uses: oven-sh/setup-bun@v1

      # ---------------------------
      # Backend
      # ---------------------------
      - name: Install backend dependencies
        working-directory: backend
        run: |
          if [ -f "bun.lockb" ]; then
            echo "Installing backend with bun"
            bun install
          else
            echo "Installing backend with npm"
            npm install
          fi

      - name: Run backend tests
        working-directory: backend
        run: |
          if [ -f "bun.lockb" ]; then
            bun test
          else
            npm test
          fi

      # ---------------------------
      # Frontend
      # ---------------------------
      - name: Install frontend dependencies
        working-directory: my-app
        run: |
          if [ -f "bun.lockb" ]; then
            echo "Installing frontend with bun"
            bun install
          else
            echo "Installing frontend with npm"
            npm install
          fi

      - name: Build frontend
        working-directory: my-app
        run: |
          if [ -f "bun.lockb" ]; then
            bun run build
          else
            npm run build
          fi
